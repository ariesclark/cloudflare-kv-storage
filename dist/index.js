"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.kv=exports.CloudflareKV=void 0;const tslib_1=require("tslib"),lodash_1=(0,tslib_1.__importDefault)(require("lodash")),ms_1=(0,tslib_1.__importDefault)(require("ms"));class CloudflareKV{constructor(e){this.options=e}request(e,t={}){return(0,tslib_1.__awaiter)(this,void 0,void 0,(function*(){const s=`https://api.cloudflare.com/client/v4/accounts/${this.options.accountId}/storage/kv/${e}`;return fetch(s,Object.assign(Object.assign({},t),{headers:Object.assign(Object.assign({},t.headers),{Authorization:`Bearer ${this.options.apiToken}`,"Content-Type":"application/json"})})).then((e=>t.text?e.text():e.json()))}))}list(e){e=Object.assign({namespaceId:this.options.namespaceId},e);const t=new URLSearchParams(lodash_1.default.omit(e,["namespaceId"])).toString();return this.request(`namespaces/${e.namespaceId}/keys?${t}`)}get(e,t){t=Object.assign({namespaceId:this.options.namespaceId},t);const s=new URLSearchParams(lodash_1.default.omit(t,["namespaceId"])).toString();return this.request(`namespaces/${t.namespaceId}/values/${encodeURIComponent(e)}?${s}`,{text:!0})}set(e,t,s){(s=Object.assign({namespaceId:this.options.namespaceId},s)).expiration_ttl&&"string"==typeof s.expiration_ttl&&(s.expiration_ttl=this.ms(s.expiration_ttl));const a=new URLSearchParams(lodash_1.default.omit(s,["namespaceId"])).toString();return this.request(`namespaces/${s.namespaceId}/values/${encodeURIComponent(e)}?${a}`,{method:"PUT",body:t,headers:{"Content-Type":"text/plain"}})}delete(e,t){t=Object.assign({namespaceId:this.options.namespaceId},t);const s=new URLSearchParams(lodash_1.default.omit(t,["namespaceId"])).toString(),a=Array.isArray(e)?e:[e];return this.request(`namespaces/${t.namespaceId}/bulk?${s}`,{method:"DELETE",body:JSON.stringify(a),headers:{"Content-Type":"application/json"}})}ms(e){return(0,ms_1.default)(e)}}exports.CloudflareKV=CloudflareKV,exports.kv=new CloudflareKV({accountId:process.env.CLOUDFLARE_ACCOUNT_ID,namespaceId:process.env.CLOUDFLARE_NAMESPACE_ID,apiToken:process.env.CLOUDFLARE_TOKEN});